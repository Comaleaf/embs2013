#include "vlab.hch"
#include "fsl.hch"

chan <unsigned 32> fsl_read;

// Polls the FSL bus until there is a word, then sends it over the fsl_read channel and repeats.
void fsl_driver() {
	unsigned 32 data_in;
	
	while (1) {
		if (FSL_FROM_MB_EXISTS) {
			FSL_FROM_MB_READ = 1;
			par {
				data_in = FSL_FROM_MB_DATA;
				FSL_FROM_MB_READ = 0;
			}
			fsl_read ! data_in;
		}
		else {
			delay;
		}
	}
}